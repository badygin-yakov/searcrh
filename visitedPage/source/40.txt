TM Feed Хабрахабр Geektimes Тостер Мой круг Фрилансим Хабрахабр Публикации Пользователи Хабы Компании Песочница Войти Регистрация 550,97 Рейтинг ua-hosting.company Хостинг-провайдер: серверы в NL / US до 100 Гбит/с Vasiliskov сегодня в 21:03 Обнаружена уязвимость в панели управления хостингом Vesta CP Хостинг, Серверное администрирование, Антивирусная защита, Блог компании ua-hosting.company В некоторых своих предыдущих статьях мы уже рассказывали о бесплатной панели управления Vesta CP. Сегодня утром мы получили тревожную информацию — в панели есть критическая уязвимость, позволяющая злоумышленникам получить доступ к серверу и производить с него DDoS атаки либо рассылать спам, что часто приводит к перерасходу трафика. Известные на текущий момент подробности, а также советы по защите чистого и очистке взломанного сервера, под катом. Первые уведомления о возможной уязвимости в Vesta 0.9.8-19 появились 7 апреля как в английской, так и в русской ветках форума панели. Симптомы у всех были схожими: резкий рост трафика и паразитической нагрузки на сервер. И по утверждениям людей, обслуживающих множество клиентских серверов, общее у них было только одно — Vesta CP. Вскоре последовали превентивные меры со стороны отдельных провайдеров — блокировка стандартного порта Весты (8083) на уровне сети провайдера, отключение провинившихся. Тем временем разработчики самой панели пытались связать взломы со своим продуктом. И нельзя сказать, что успешно. По утверждениям самих разработчиков, им не удалось достоверно установить и воспроизвести вектор атаки, однако они выпустили хотфикс, закрывающий некоторые прорехи, которые могли послужить причиной. А именно, поправили авторизацию и сделали проверку паролей более строгой. Пока что не поступало информации об успешных взломах обновлённой Vesta 0.9.8-20, однако тот факт, что разработчики не смогли достоверно установить сам вектор атаки, держит пользователей в некоторой напряжённости. Ниже мы приводим некоторые рекомендации из сети по предотвращению взлома и по борьбе с последствиями. Что делать, если Ваш сервер ещё не взломали? Большинство приведённых ниже рекомендаций относятся не только к серверам с Vesta CP, но и к любому другому Linux серверу. Первым делом, обновите панель, выполнив команду: v-update-sys-vesta-all
 Смените в /usr/local/vesta/nginx/conf/nginx.conf стандартный порт 8083 на какой-либо другой по Вашему усмотрению. Используйте нестандартный порт SSH. По возможности используйте вход по ключам. Также желательно отключить вход под root из мира. Скачайте и запустите Linux Environment Security. Скачайте и установите Linux malware detect. После установки запустите первичный анализ системы на уже существующие проблемы: maldet -a / (и проанализируйте отчёт). Если всё в порядке, запустите мониторинг: maldet --monitor /. Не забудьте указать свою электронную почту для получения отчётов в /usr/local/maldet.conf. Ещё один очень полезный инструмент, который стоит установить — Config Server Firewall. Внимательно изучите файл конфигурации и обязательно включите отслеживание изменений директорий и файлов. Если у Вас не ожидается пользователей, клиентов или посетителей из Китая — заблокируйте его весь на уровне фаервола. Установите приложение для мониторинга трафика. Например, ntopng. А если уже взломали? Пятна Последствия от данной атаки устраняются достаточно непросто, потому, если у Вас есть такая возможность, советуем использовать Vanish слить бэкапы (о необходимости их делать мы напоминали не раз) и переустановить сервер. Сложность заключается в том, что Trojan.DDoS_XOR-1 (он же Chinese Chicken Multiplatform DoS botnets Trojan), которым было заражено большинство скомпрометированных машин, очень эффективно самовосстанавливается, и для его удаления нужны определённые танцы с бубном (описаны ниже). Другая сложность — возможна банальная перегрузка сервера паразитическими процессами, что существенно усложнит Вашу работу с сервером вне rescue mode (которого может и не существовать в принципе, если Вы используете VPS). Если же возможности просто переустановить всё нет, попробуйте проделать следующее. Проверьте, есть ли симптомы заражения Trojan.DDoS_XOR. Проявляется он в выводе top как файл со случайным именем вида H8wuaqwiu, S01wefiouh8 и т.п. либо как системная команда, порой даже не предполагающая длительного исполнения: ls, ifconfig, pwd, ping, awk, telnet… Второй симптом — наличие .sh файла в папке ежечасного крона. Проверить можно командой ls -la /etc/cron.hourly/. Файл часто называется gcc.sh, cron.sh, но возможны и другие имена. Посмотрите содержимое .sh файла. Например, командой cat /etc/cron.hourly/gcc.sh. Для файла характерно примерно следующее содержимое: #!/bin/sh PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:/usr/X11R6/bin for i in `cat /proc/net/dev | grep: | awk -F: {'print $ 1'}`; do ifconfig $ i up & done cp /lib/libudev.so /lib/libudev.so.6 /lib/libudev.so.6 Вляпались? Не спешите суетиться, троян восстанавливает свои файлы быстрее, чем вы успеете их все удалить. Но он будет пытаться использовать те же самые имена файлов, так что блокировка должна помочь: chmod 0 /etc/cron.hourly/gcc.sh; chattr +ia /etc/cron.hourly/gcc.sh;  chattr + i /etc/crontab И процесс полностью убивать тоже бесполезно, рекомендуется сначала его остановить, чтобы троян не пытался его перезапустить. В выводе команды top найдите процесс, вызвавший подозрение (к примеру, S01wefiouh8), и выполните: kill -STOP 16621 Найдите исполняемые файлы и заблокируйте их. Для поиска используйте команду find /etc -name '* S01wefiouh8 *'. Для найденных файлов выполните chmod 0 /имя/файла; chattr +ia /имя/файла. Удалите исполняемые файлы, найденные в /usr/bin (с помощью ls -lt /usr/bin | head можете поискать другие, вызывающие подозрение): rm -f /usr/bin/S01wefiouh8 Теперь можно добить остановленный процесс: pkill mtyxkeaofa И наконец, удалите тело вируса: rm -f /lib/libudev*.so Если Вы — хостер или сисадмин, и Вам нужно оставить доказательство для клиента, остальные файлы можете пока не трогать. Если нет — удалите все остальные «примороженные» файлы. Также, если Вам не удалось самим определить вредоносные файлы, воспользуйтесь ClamAV или RKHunter и посмотрите их отчёт. Если у Вас есть дополнительная информация о данной проблеме, пишите в комментариях. Подписывайтесь на наш канал и этот топик, мы также будем следить за развитием событий и публиковать в этой статье важные обновления. Спасибо, что остаётесь с нами. Вам нравятся наши статьи? Хотите видеть больше интересных материалов? Поддержите нас оформив заказ или порекомендовав знакомым, 30% скидка для пользователей Хабра на уникальный аналог entry-level серверов, который был придуман нами для Вас: Вся правда о VPS (KVM) E5-2650 v4 (6 Cores) 10GB DDR4 240GB SSD 1Gbps от $20 или как правильно делить сервер? (доступны варианты с RAID1 и RAID10, до 24 ядер и до 40GB DDR4). Dell R730xd в 2 раза дешевле? Только у нас 2 х Intel Dodeca-Core Xeon E5-2650v4 128GB DDR4 6x480GB SSD 1Gbps 100 ТВ от $249 в Нидерландах и США! Читайте о том Как построить инфраструктуру корп. класса c применением серверов Dell R730xd Е5-2650 v4 стоимостью 9000 евро за копейки? Метки: vesta vestacp безопасность безопасность веб-приложений Добавить метки Пометьте публикацию своими метками Метки необходимо разделять запятой. Например: php, javascript, андронный коллайдер, задача трех тел Сохранить +5 4 268 Комментировать Нарушение Опишите суть нарушения Отправить Выберите рекомендации для отправки автору: Указан только блог Орфографические ошибки Пунктуационные ошибки Отступы Текст-простыня Короткие предложения Смайлики Много форматирования Картинки Ссылки Оформление кода Рекламный характер Отправить ua-hosting.company 550,97 Хостинг-провайдер: серверы в NL / US до 100 Гбит/с 51,2 Карма 4,0 Рейтинг 7 Подписчики Кирилл Василисков Vasiliskov Веб-разработчик Сайт Поделиться публикацией Похожие публикации 26 октября 2015 в 12:38 В Joomla исправили баг, который ставил под угрозу безопасность миллионов сайтов +7 18,4k 56 8 20 октября 2015 в 15:35 1Password меняет формат файлов по умолчанию для повышения уровня безопасности +14 16,7k 44 20 23 сентября 2015 в 13:01 Brotli — новый алгоритм сжатия веб-данных от Google +12 24,5k 99 12 Комментарии 0 Только полноправные пользователи могут оставлять комментарии. Войдите, пожалуйста. Информация Дата основания 10 июля 2009 Локация Белиз-Сити Белиз Сайт ua-hosting.company Численность 11–30 человек Дата регистрации 02 октября 2012 Виджет [100ТБ сервер в Нидерландах в дата-центре премиум-класса EvoSwitch] Процессор 2 х Intel Dodeca-Core Xeon E5-2650 v4 Память (RAM) 128GB DDR4 Накопители 6 x 480GB SSD Порт 1000 Mbps $599 $249 / месяц ЗАКАЗАТЬ СЕРВЕР В NL/US ПО ВОЛШЕБНОЙ ЦЕНЕ Виджет [Виртуальный сервер в Нидерландах с выделенным накопителем] Процессор VPS (KVM) - E5-2650 v4 (6 Cores) Память (RAM) 10GB DDR4 Накопитель 240GB SSD Порт 1000 Mbps $29 / месяц ЗАКАЗАТЬ АНАЛОГ СЕРВЕРА В NL ПО ВОЛШЕБНОЙ ЦЕНЕ Виджет [100ТБ сервер в Нидерландах в дата-центре премиум-класса EvoSwitch] Процессор 2 x Intel Quad Core E5620 Память (RAM) 32GB DDR3 Накопители 6 x 240GB SSD Порт 1000 Mbps $289 $139 / месяц ЗАКАЗАТЬ СЕРВЕР В NL/US ПО ВОЛШЕБНОЙ ЦЕНЕ Виджет [Виртуальный сервер в Нидерландах с выделенным накопителем] Процессор VPS (KVM) - E5-2650 v4 (12 Cores) Память (RAM) 20GB DDR4 Накопитель 480GB SSD Порт 1000 Mbps $49 / месяц ЗАКАЗАТЬ АНАЛОГ СЕРВЕРА В NL ПО ВОЛШЕБНОЙ ЦЕНЕ Виджет [Облачный сервер в Нидерландах и США с каналом 1 Гбит / с] [S] Ядра (vCPU) 1 Core Память (vRAM) 1 GB Дисковая квота 40 GB (SSD Storage) Порт 1000 Mbps Премиум трафик 4 TB ФаерволCisco ASA 5500 included! $9,00 $3,99 / месяц ЗАКАЗАТЬ ОБЛАЧНЫЙ СЕРВЕР В NL/US ПО ВОЛШЕБНОЙ ЦЕНЕ Блог на Хабрахабре Обнаружена уязвимость в панели управления хостингом Vesta CP 268 0 Конференция DEFCON 22. «Вооружение Ваших домашних питомцев. Боевая Киска и cобака для отказа сервиса». Джен Бренсфилд 3,9k 8 Конференция DEFCON 23. «Как я сбивал назойливый дрон соседского ребёнка». Майкл Робинсон 30,7k 38 Как специалисты Google Adwords помогли мне выбросить 150 000 грн (около $6000) за месяц или почему я больше не буду… 49k 251 Конференция DEFCON 22. «Путешествие по тёмной стороне Интернет. Введение в Tor, Darknet и Bitcoin» 9k 3 Конференция DEFCON 22. «Один дома с автоматической системой защиты». Крис Литтлбери 2,8k 2 Конференция DEFCON 17. «Это восхитительное время, когда меня обвинили в ущербе на 2 миллиарда долларов». Джейсон Скотт 11k 11 DEFCON 23. «Let'sEncrypt: чеканка бесплатных сертификатов шифрования для Интернет». Ян Жу, Питер Эккерсли, Джеймс Кастен 4,5k 7 Конференция DEFCON 16. «Криминальная разработка iOS Cisco». Феликс Линднер, глава Recurity Labs 2,9k 2 Конференция DEFCON 18. «Как я встретился с Вашей девушкой, или новый вид Интернет-атак». Сэми Камкар 8,3k 3 Самое читаемое Сутки Неделя Месяц Почему в 2018 году я использую метод разработки, которому уже 30 лет +24 12,9k 56 19 История про блокчейн и немного про биткойны +24 10,8k 65 18 Для чего программисту Continuous Integration и с чего начинать +42 14,9k 220 42 Как пользователи учат Яндекс предупреждать о телефонном спаме +48 9k 18 96 Firefox Gecko, «который мы потеряли» +10 5,8k 15 71 Как специалисты Google Adwords помогли мне выбросить 150 000 грн (около $6000) за месяц или почему я больше не буду… +86 49k 123 251 Как я за 9 месяцев превратился из неофита в разработчика ПО без отрыва от основной работы +31 38k 305 38 Почему я не подписываю соглашения о неконкуренции +87 32,7k 84 166 Конференция DEFCON 23. «Как я сбивал назойливый дрон соседского ребёнка». Майкл Робинсон +60 30,7k 135 38 Мессенджеры, пора делать следующий шаг +18 30,2k 83 220 Как уже снова не получить телефон (почти) любой красотки в Москве, или интересная особенность MT_FREE +129 163k 260 101 Мы нашли крупную компанию, которая 5 лет не занималась информационной безопасностью, и она ещё жива +30 79k 119 97 Как Red Hat убила свой главный продукт и стала многомиллиардной корпорацией +89 67,4k 105 68 Дискредитация специалистов или современные собеседования +77 61,6k 153 675 [BugBounty] Раскрытие 5 миллионов ссылок в приватные чаты Telegram и возможность редактирования любой статьи telegra.ph +116 58k 172 66 Интересные публикации Хабрахабр Geektimes Обнаружена уязвимость в панели управления хостингом Vesta CP +5 222 3 0 Роскомнадзор продолжает уничтожать Интернет: настала очередь Google GT +9 4k 4 12 Имитация левитации воды на Ардуино GT +18 2,9k 14 16 Охота на Dofoil с помощью Windows Defender ATP +10 442 2 1 Лишать гарантии за оторванную наклейку или пломбу — незаконно GT +16 3,8k 7 1 TDD ошибочно? +22 2,3k 28 2 Журналисты нашли в Москве 11 пунктов обмена криптовалюты и 4 биткоин-банкомата +7 1,6k 3 2 JNI: Подружим Java и C++ +6 1,4k 26 4 Новый апдейт iOS сделал неоригинальные экраны «восьмерок» неработоспособными GT +24 10,3k 7 37 Apple заставят заплатить $500 млн патентному троллю GT +8 5,6k 3 6 Аккаунт Войти Регистрация Разделы Публикации Хабы Компании Пользователи Песочница Информация Правила Помощь Документация Соглашение Конфиденциальность Услуги Реклама Тарифы Контент Семинары Приложения © 2006 – 2018 «TM» О сайте Служба поддержки Мобильная версия
